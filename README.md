# üß† Neuromorphometrics Surface Extraction & Labeling

This repository contains the script `Neuromorphometrics_surface.ipynb`, which I used to generate cortical surface representations based on the **Neuromorphometrics atlas** distributed with SPM. This includes work on both the original atlas and a modified version with additional subcortical structures (e.g., hippocampus, amygdala).

---

## üóÇ Files and Resources

- `labels_Neuromorphometrics.nii` ‚Äî original atlas from `SPM/tpm/`
- `labels_neuromorphics_extra.nii` ‚Äî extended atlas with added regions (included in this repo)
- `diplay_labels_original_vs_extra.png` ‚Äî visual comparison of anatomical misalignment
- `Mayavi_left_boundary_plot.png`, `Mayavi_right_boundary_plot.png` ‚Äî examples of surface edge detection

---

## ‚ùó Observations

Upon inspection, I discovered that the **original** and **extra** Neuromorphometrics label files are **not anatomically aligned**.

üîç See: `diplay_labels_original_vs_extra.png`

- The original labels appear to be based on **Template4** used in the Neuromorphometrics tool.
- The extra label version seems to have been generated by injecting new structures into a single-subject training directory and rerunning the tool ‚Äî hence the spatial mismatch.

---
## üßæ Processing Pipeline Overview

### 1. **Cortical Label Extraction**
- Loaded `labels_Neuromorphometrics.nii`
- Created `labels_Neuromorphometrics_cortical_only.nii.gz`
  - All non-cortical and WM structures set to `0`

### 2. **White Matter Boundary Expansion**
- Extracted WM labels (indices `44`, `45`)
- Combined into a single binary mask and dilated by 1 voxel
  - Ensures that the extracted cortical surface lies within the cortical ribbon

### 3. **Surface Generation**
- Extracted the cortical surface
- Applied surface smoothing
- Saved to:
  - `.obj` (for visualization with [Display](https://www.bic.mni.mcgill.ca/ServicesSoftware/Display))
  - `.gii` (for MATLAB/Freesurfer compatibility)

### 4. **Surface Sampling & Cleaning**
- Intersected the surface with the original label file to retrieve vertex-wise labels
- Applied multiple post-processing steps:
  - Neighbourhood majority vote for label smoothing
  - Re-assigned `0` (unlabeled) vertices using nearest labeled neighbors
- Performed separately for left and right hemispheres
- Output files:
  - `right_surface_labels.txt`
  - `left_surface_labels.txt`

---

## üñº Surface Visualization 

### 1. In Python
I explored different ways to visualize the surfaces using Python:

#### 1.1 **Plotly** (2D web-based rendering)
- `Plotly_right_surface_plot.png`
- `Plotly_left_surface_plot.png`

#### 1.2 **Nilearn** (2D static plots)
- `Nilearn_right_surface_plot.png`
- `Nilearn_left_surface_plot.png`

#### 1.3 **Mayavi** (3D rendering, similar to MATLAB)
- `Mayavi_right_surface_plot.png`
- `Mayavi_left_surface_plot.png`

### 2. With Display

```bash
Display wm_right_surface_smoothed.obj -vertex right_surface_labels.txt 
```

---

##  üìä Project statistics on surfaces

In the final section (using the *extra* labels and surfaces), I prepared NIfTI volumes and text files that make it easy to **visualize statistical results on surfaces**.

### 1. Creation of a 3D statistical nifti file 

Useful for **MATLAB** visualisation.

#### 1.1 Creation of a perfect cortical labels

To ensure anatomical consistency between cortical labels and surface positions:

- Created a 2 mm thick cortical ribbon by projecting the surface vertex labels into voxel space

üì¶ **Output:**
- `surface_labels_projected_thick2.nii`

#### 1.2 Project statistical values

Using an example from Cristina, I assigned statistical values (e.g., p-values, t-values) to the projected cortical labels.

üì¶ **Output:**
- `surface_labels_projected_with_statvalues.nii`

‚û°Ô∏è This can be used in **MATLAB** to overlay stats on:
- `wm_combined_extra_surface_smoothed.gii`



### 2. Creaton of a 2D statistical obj + txt file 

This is useful if you want to visualize or analyze the stats in **Python**, or **Display** directly on the mesh.

üßæ **Input:**
- Vertex-wise label text files:
  - `right_extra_surface_labels.txt`
  - `left_extra_surface_labels.txt`
- Corresponding smoothed surfaces:
  - `wm_right_extra_surface_smoothed.obj`
  - `wm_left_extra_surface_smoothed.obj`

üì¶ **Output:**
- Vertex-wise stats:
  - `right_extra_surface_labels_stats.txt`
  - `left_extra_surface_labels_stats.txt`


